/*
 * bowl.js v0.0.3
 * (c) 2016-2016 classicemi
 * Released under the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bowl=t()}(this,function(){"use strict";function e(e){return"[object Object]"===Object.prototype.toString.call(e)}function t(e){return/^(https?|\/\/)/.test(e)}var n=window,r=function(){this.timeout=6e4,this.ingredients=[]};r.prototype.add=function(e){var r=this,o=function(e){if(e.url){var o=(new Date).getTime(),i=t(e.url);e.key=e.key||e.url,e.expire=o+3600*(e.expire?e.expire:100)*1e3,e.url=i?e.url:""+n.location.href+e.url.replace(new RegExp("^/*"),""),r.ingredients.push(e)}};e.forEach(function(e){return o(e)})},r.prototype.normalInject=function(){this.ingredients.forEach(function(e){var t=document.createElement("script");t.src=e.url,document.getElementsByTagName("body")[0].appendChild(t)})},r.prototype.appendScript=function(e){var t=document.createElement("script");t.defer=!0,t.text=e,document.getElementsByTagName("head")[0].appendChild(t)},r.prototype.inject=function(){var e=this,t=this;if(!n.localStorage||!n.Promise)return void this.normalInject();var r=function(e){var n=new XMLHttpRequest,r=new Promise(function(t,r){n.open("GET",e),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status&&n.responseText?t({content:n.responseText}):r(new Error(n.statusText)))}});return setTimeout(function(){n.readyState<4&&n.abort()},t.timeout),n.send(),r};this.ingredients.forEach(function(t){var n=localStorage.getItem(t.key);n?(n=JSON.parse(n),e.appendScript(n.content)):r(t.url).then(function(n){t.content=n.content,e.appendScript(n.content),localStorage.setItem(t.key,JSON.stringify(t))})})},r.prototype.remove=function(t){t=e(t)?t.key:t;var n=this.ingredients.findIndex(function(e){return e.key===t});this.ingredients.splice(n,1),localStorage.removeItem(t)};var o=new r;return o});