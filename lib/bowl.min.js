/*
 * bowl.js v0.0.7
 * (c) 2016-2016 classicemi
 * Released under the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bowl=t()}(this,function(){"use strict";function e(e){return"[object Object]"===Object.prototype.toString.call(e)}function t(e){return"[object String]"===Object.prototype.toString.call(e)}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return/^(https?|\/\/)/.test(e)}function o(t){var r=null;if(e(t)){r={};for(var i in t)e(t[i])||n(t[i])?r[i]=o(t[i]):r[i]=t[i]}else n(t)?(r=[],t.forEach(function(t,i){return e(t)||n(t)?void(r[i]=o(t)):void(r[i]=t)})):r=t;return r}function i(t,n,r){if(void 0===r&&(r=!1),e(t)&&e(n)){var i=o(t);for(var c in n)i.hasOwnProperty(c)?i[c]=r?o(n[c]):i[c]:i[c]=o(n[c]);return i}}var c=window,u="bowl-",a=function(){this.config={timeout:6e4},this.ingredients=[]};return a.prototype.configure=function(e){this.config=i(this.config,e,!0)},a.prototype.add=function(t){if(!n(t)){if(!e(t))return;t=[t]}var o=this,i=function(e){if(e.url){var t={},n=(new Date).getTime(),i=r(e.url);t.key=""+u+(e.key||e.url),t.expireAfter=n+3600*(e.expireAfter?e.expireAfter:100)*1e3,t.expireWhen=e.expireWhen?e.expireWhen:null,t.url=i?e.url:c.location.origin+"/"+e.url.replace(new RegExp("^/*"),""),o.ingredients.push(t)}};t.forEach(function(e){return i(e)})},a.prototype.normalInject=function(e){var t=document.createElement("script");t.src=e,document.body.appendChild(t)},a.prototype.appendScript=function(e){var t=document.createElement("script");t.defer=!0,t.text=e,document.getElementsByTagName("head")[0].appendChild(t)},a.prototype.inject=function(){var e=this;if(!this.ingredients.length)return!1;var t=this,n=[];if(!c.localStorage||!c.Promise)return void this.ingredients.forEach(function(t){e.normalInject(t.url)});var r=function(e){var n=new XMLHttpRequest,r=new Promise(function(t,r){n.open("GET",e),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status&&n.responseText?t({content:n.responseText}):r(new Error(n.statusText)))}});return setTimeout(function(){n.readyState<4&&n.abort()},t.config.timeout),n.send(),r};return this.ingredients.forEach(function(t){n.push(new Promise(function(n,o){if(t.noCache)return e.normalInject(t.url),void n();var i=localStorage.getItem(t.key);i?(i=JSON.parse(i),e.appendScript(i.content),n()):r(t.url).then(function(r){t.content=r.content,e.appendScript(r.content),localStorage.setItem(t.key,JSON.stringify(t)),n()})}))}),Promise.all(n)},a.prototype.remove=function(n){var r=this;if(!n){var o=this.ingredients.map(function(e){return e.key});return o.forEach(function(e){return r._removeStorage(e)}),void(this.ingredients=[])}var i=null;t(n)?i=""+u+n:e(n)&&(i=""+u+(n.key?n.key:n.url?n.url:""));var c=this.ingredients.findIndex(function(e){return e.key===i});this.ingredients.splice(c,1),localStorage.removeItem(i)},a.prototype._removeStorage=function(e){localStorage.removeItem(e)},a});