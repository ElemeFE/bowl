/*
 * bowl.js v0.0.2
 * (c) 2016-2016 classicemi
 * Released under the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bowl=t()}(this,function(){"use strict";function e(e){return"[object Object]"===Object.prototype.toString.call(e)}var t=window,n=function(){this.timeout=6e4,this.ingredients=[]};n.prototype.add=function(e){var n=this,r=function(e){if(e.url){var r=(new Date).getTime(),o=util.isUrl(e.url);e.key=e.key||e.url,e.expire=r+3600*(e.expire?e.expire:100)*1e3,e.url=o?e.url:""+t.location.href+e.url.replace(new RegExp("^/*"),""),n.ingredients.push(e)}};e.forEach(function(e){return r(e)})},n.prototype.normalInject=function(){this.ingredients.forEach(function(e){var t=document.createElement("script");t.src=e.url,document.getElementsByTagName("body")[0].appendChild(t)})},n.prototype.appendScript=function(e){var t=document.createElement("script");t.defer=!0,t.text=e,document.getElementsByTagName("head")[0].appendChild(t)},n.prototype.inject=function(){var e=this,n=this;if(!t.localStorage||!t.Promise)return void this.normalInject();var r=function(e){var t=new XMLHttpRequest,r=new Promise(function(n,r){t.open("GET",e),t.onreadystatechange=function(){4===t.readyState&&(200===t.status||0===t.status&&t.responseText?n({content:t.responseText}):r(new Error(t.statusText)))}});return setTimeout(function(){t.readyState<4&&t.abort()},n.timeout),t.send(),r};this.ingredients.forEach(function(t){var n=localStorage.getItem(t.key);n?(n=JSON.parse(n),e.appendScript(n.content)):r(t.url).then(function(n){t.content=n.content,e.appendScript(n.content),localStorage.setItem(t.key,JSON.stringify(t))})})},n.prototype.remove=function(t){t=e(t)?t.key:t;var n=this.ingredients.findIndex(function(e){return e.key===t});this.ingredients.splice(n,1),localStorage.removeItem(t)};var r=new n;return r});