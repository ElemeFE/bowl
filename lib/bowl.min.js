/*
 * bowl.js v0.0.4
 * (c) 2016-2016 classicemi
 * Released under the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bowl=t()}(this,function(){"use strict";function e(e){return"[object Object]"===Object.prototype.toString.call(e)}function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e){return/^(https?|\/\/)/.test(e)}var r=window,o="bowl-",i=function(){this.timeout=6e4,this.ingredients=[]};return i.prototype.add=function(i){if(!t(i)){if(!e(i))return;i=[i]}var c=this,u=function(e){var t={};if(e.url){var i=(new Date).getTime(),u=n(e.url);t.key=""+o+(e.key||e.url),t.expireAfter=i+3600*(e.expireAfter?e.expireAfter:100)*1e3,t.expireWhen=e.expireWhen?e.expireWhen:null,t.url=u?e.url:r.location.origin+"/"+e.url.replace(new RegExp("^/*"),""),c.ingredients.push(t)}};i.forEach(function(e){return u(e)})},i.prototype.normalInject=function(e){var t=document.createElement("script");t.src=e,document.body.appendChild(t)},i.prototype.appendScript=function(e){var t=document.createElement("script");t.defer=!0,t.text=e,document.getElementsByTagName("head")[0].appendChild(t)},i.prototype.inject=function(){var e=this;if(!this.ingredients.length)return!1;var t=this,n=[];if(!r.localStorage||!r.Promise)return void this.ingredients.forEach(function(t){e.normalInject(t.url)});var o=function(e){var n=new XMLHttpRequest,r=new Promise(function(t,r){n.open("GET",e),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status&&n.responseText?t({content:n.responseText}):r(new Error(n.statusText)))}});return setTimeout(function(){n.readyState<4&&n.abort()},t.timeout),n.send(),r};return this.ingredients.forEach(function(t){n.push(new Promise(function(n,r){if(t.noCache)return e.normalInject(t.url),void n();var i=localStorage.getItem(t.key);i?(i=JSON.parse(i),e.appendScript(i.content),n()):o(t.url).then(function(r){t.content=r.content,e.appendScript(r.content),localStorage.setItem(t.key,JSON.stringify(t)),n()})}))}),Promise.all(n)},i.prototype.remove=function(t){var n=this;if(!t){var r=this.ingredients.map(function(e){return e.key});r.forEach(function(e){return n._removeStorage(e)}),this.ingredients=[]}t=""+o+(e(t)?t.key:t);var i=this.ingredients.findIndex(function(e){return e.key===t});this.ingredients.splice(i,1),localStorage.removeItem(t)},i.prototype._removeStorage=function(e){localStorage.removeItem(e)},i});